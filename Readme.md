# Users API — POST /api/users/register

Description
- Register a new user and receive a JWT token.
- The route is mounted in [`Backend/app.js`](Backend/app.js) as `app.use('/api/users', userRoutes)`, implemented in [`Backend/routes/user.routes.js`](Backend/routes/user.routes.js) and handled by the controller [`registerUser`](Backend/controllers/user.controller.js).

Endpoint
- Method: POST
- URL: /api/users/register

Request Headers
- Content-Type: application/json

Request Body (JSON)
- Required shape:
  {
    "fullname": {
      "firstname": "string (min 3 chars)",
      "lastname": "string (optional, min 3 chars)"
    },
    "email": "string (valid email)",
    "password": "string (min 6 chars)"
  }

Validation
- `email` must be a valid email ([see validation rules in](Backend/routes/user.routes.js)).
- `fullname.firstname` minimum length 3.
- `password` minimum length 6.

Behavior
- The controller (`[`registerUser`](Backend/controllers/user.controller.js)`) hashes the password using the static helper [`hashPassword`](Backend/models/user.model.js) and creates a user document using the model in [`Backend/models/user.model.js`](Backend/models/user.model.js).
- On successful creation the controller returns a JWT token generated by the instance method [`generateAuthToken`](Backend/models/user.model.js).

Responses
- 201 Created
  - Body example:
    {
      "token": "<JWT token string>"
    }
- 400 Bad Request
  - Returned when input validation fails. Body contains `errors` array from `express-validator`.
- 500 Internal Server Error
  - Returned on unexpected server/database errors.

Relevant files and symbols
- [Backend/app.js](Backend/app.js)
- [Backend/routes/user.routes.js](Backend/routes/user.routes.js)
- [`registerUser`](Backend/controllers/user.controller.js)
- [Backend/controllers/user.controller.js](Backend/controllers/user.controller.js)
- [Backend/models/user.model.js](Backend/models/user.model.js)
  - [`hashPassword`](Backend/models/user.model.js)
  - [`generateAuthToken`](Backend/models/user.model.js)
- [Backend/services/user.services.js](Backend/services/user.services.js)

Example Request (curl)
curl -X POST http://localhost:4000/api/users/register \
  -H "Content-Type: application/json" \
  -d '{"fullname":{"firstname":"John","lastname":"Doe"},"email":"john@example.com","password":"secret123"}'

  ### Example Response

  curl -X POST http://localhost:4000/api/users/register \
  -H "Content-Type: application/json" \
  -d '{"fullname":{"firstname":"John","lastname":"Doe"},"email":"john@example.com","password":"secret123"}'

### POST /api/users/login

Description
- Authenticate a user with email and password and receive a JWT token.

Endpoint
- Method: POST
- URL: /api/users/login

Request Headers
- Content-Type: application/json

Request Body (JSON)
- Required shape:
  {
    "email": "string (valid email)",
    "password": "string (required)"
  }

Validation
- `email` must be a valid email.
- `password` must be provided.

Behavior
- The controller validates input using express-validator.
- Finds the user by email and includes the hashed password for comparison.
- Compares provided password with stored hash using bcrypt.
- On success returns a JWT token and the user object.

Responses
- 200 OK
  - Body example:
    {
      "token": "<JWT token string>",
      "user": { /* user object (may include fields per model) */ }
    }
- 400 Bad Request
  - Returned when input validation fails. Body contains `errors` array from `express-validator`.
- 401 Unauthorized
  - Returned when email or password is incorrect.
- 500 Internal Server Error
  - Returned on unexpected server/database errors.

Example Request (curl)
curl -X POST http://localhost:4000/api/users/login \
  -H "Content-Type: application/json" \
  -d '{"email":"john@example.com","password":"secret123"}'


  
// ...existing code...
# Users API — POST /api/users/register

Description
- Register a new user and receive a JWT token.
- The route is mounted in [`Backend/app.js`](Backend/app.js) as `app.use('/api/users', userRoutes)`, implemented in [`Backend/routes/user.routes.js`](Backend/routes/user.routes.js) and handled by the controller [`registerUser`](Backend/controllers/user.controller.js).

Endpoint
- Method: POST
- URL: /api/users/register

Request Headers
- Content-Type: application/json

Request Body (JSON)
- Required shape:
  {
    "fullname": {
      "firstname": "string (min 3 chars)",
      "lastname": "string (optional, min 3 chars)"
    },
    "email": "string (valid email)",
    "password": "string (min 6 chars)"
  }

Validation
- `email` must be a valid email ([see validation rules in](Backend/routes/user.routes.js)).
- `fullname.firstname` minimum length 3.
- `password` minimum length 6.

Behavior
- The controller (`[`registerUser`](Backend/controllers/user.controller.js)`) hashes the password using the static helper [`hashPassword`](Backend/models/user.model.js) and creates a user document using the model in [`Backend/models/user.model.js`](Backend/models/user.model.js).
- On successful creation the controller returns a JWT token generated by the instance method [`generateAuthToken`](Backend/models/user.model.js).

Responses
- 201 Created
  - Body example:
    {
      "token": "<JWT token string>"
    }
- 400 Bad Request
  - Returned when input validation fails. Body contains `errors` array from `express-validator`.
- 500 Internal Server Error
  - Returned on unexpected server/database errors.

Relevant files and symbols
- [Backend/app.js](Backend/app.js)
- [Backend/routes/user.routes.js](Backend/routes/user.routes.js)
- [`registerUser`](Backend/controllers/user.controller.js)
- [Backend/controllers/user.controller.js](Backend/controllers/user.controller.js)
- [Backend/models/user.model.js](Backend/models/user.model.js)
  - [`hashPassword`](Backend/models/user.model.js)
  - [`generateAuthToken`](Backend/models/user.model.js)
- [Backend/services/user.services.js](Backend/services/user.services.js)

Example Request (curl)
curl -X POST http://localhost:4000/api/users/register \
  -H "Content-Type: application/json" \
  -d '{"fullname":{"firstname":"John","lastname":"Doe"},"email":"john@example.com","password":"secret123"}'

  ### Example Response

  curl -X POST http://localhost:4000/api/users/register \
  -H "Content-Type: application/json" \
  -d '{"fullname":{"firstname":"John","lastname":"Doe"},"email":"john@example.com","password":"secret123"}'

### POST /api/users/login

Description
- Authenticate a user with email and password and receive a JWT token.

Endpoint
- Method: POST
- URL: /api/users/login

Request Headers
- Content-Type: application/json

Request Body (JSON)
- Required shape:
  {
    "email": "string (valid email)",
    "password": "string (required)"
  }

Validation
- `email` must be a valid email.
- `password` must be provided.

Behavior
- The controller validates input using express-validator.
- Finds the user by email and includes the hashed password for comparison.
- Compares provided password with stored hash using bcrypt.
- On success returns a JWT token and the user object.

Responses
- 200 OK
  - Body example:
    {
      "token": "<JWT token string>",
      "user": { /* user object (may include fields per model) */ }
    }
- 400 Bad Request
  - Returned when input validation fails. Body contains `errors` array from `express-validator`.
- 401 Unauthorized
  - Returned when email or password is incorrect.
- 500 Internal Server Error
  - Returned on unexpected server/database errors.

Example Request (curl)
curl -X POST http://localhost:4000/api/users/login \
  -H "Content-Type: application/json" \
  -d '{"email":"john@example.com","password":"secret123"}'
// ...existing code...

### GET /api/users/profile

Description
- Retrieve the authenticated user's profile.

Endpoint
- Method: GET
- URL: /api/users/profile
- Protected: Yes — requires a valid JWT.

Authentication
- Provide the JWT either as an HTTP-only cookie named `token` (set on login/register) or in the Authorization header:
  Authorization: Bearer <token>

Behavior
- The auth middleware verifies the token and attaches the user to `req.user`.
- The controller returns the user object from `req.user`.

Responses
- 200 OK
  - Body example:
    {
      "message": "User fetched successfully",
      "user": { /* user object */ }
    }
- 401 Unauthorized
  - Returned when token is missing, invalid, or expired.
- 500 Internal Server Error
  - Returned on unexpected server/database errors.

Example Request (curl using Authorization header)
curl -X GET http://localhost:4000/api/users/profile \
  -H "Authorization: Bearer <JWT token>"

Example Request (curl using cookie)
curl -X GET http://localhost:4000/api/users/profile \
  -H "Cookie: token=<JWT token>"

### GET /api/users/logout

Description
- Log out the authenticated user by clearing the cookie and blacklisting the token.

Endpoint
- Method: GET
- URL: /api/users/logout
- Protected: Yes — requires a valid JWT.

Behavior
- Clears the `token` cookie.
- If a token is present (cookie or Authorization header), it is saved to a blacklist collection so it cannot be reused.
- Returns a confirmation message.

Responses
- 200 OK
  - Body example:
    {
      "message": "Logged out successfully"
    }
- 401 Unauthorized
  - Returned when token is missing or invalid (depending on auth middleware behavior).
- 500 Internal Server Error
  - Returned on unexpected server/database errors.

Example Request (curl)
curl -X GET http://localhost:4000/api/users/logout \
  -H "Authorization: Bearer <JWT token>"


### Example Response

- `captain` (object) :
- `fullname` (object).
- `firstname` (string): User's first name 
-`lastname` (string): user's last name  
-`email`(string) : User's email adreess 
- `password` (string) : User's password 
-`vechile` (object)
-`color` (string) vechile color (minimum)
- `capacity` (number) vechile capacity
- `vechileType` (string) vechile type

-`plate` (string) vechile number plate 


- `token` (String) JWT token

**Captains API — /api/captains**

Description
- Manage captain accounts (register, login, profile, logout) and receive a JWT token.

Base route
- Mounted in `Backend/app.js` as `app.use('/api/captains', captainRoutes)` and implemented in `Backend/routes/captain.routes.js`.

Authentication
- The JWT is set as an HTTP-only cookie named `token` on login/register and may also be sent in the `Authorization: Bearer <token>` header.

1) POST /api/captains/register
- Description: Create a new captain account and return a JWT token.
- Request Headers: `Content-Type: application/json`
- Request Body (JSON):

{
  "fullname": "string (min 3 chars)", // required: captain's full name
  "email": "string (valid email)", // required
  "password": "string (min 6 chars)", // required
  "vehicle": {
    "color": "string (min 3 chars)", // required
    "plate": "string (min 3 chars)", // required
    "capacity": 2, // number, required, min 1
    "type": "bike" // required, one of: bike, car, auto
  }
}

- Validation (see `Backend/routes/captain.routes.js`):
  - `email` must be a valid email
  - `fullname` length >= 3
  - `password` length >= 6
  - `vehicle.color` length >= 3
  - `vehicle.plate` length >= 3
  - `vehicle.capacity` integer >= 1
  - `vehicle.type` one of `bike`, `car`, `auto`

- Success Response (201 Created):

{
  "token": "<JWT token string>",
  "captain": {
    "_id": "<id>",
    "fullname": "string",
    "email": "string",
    "vehicle": {
      "color": "string",
      "plate": "string",
      "capacity": 2,
      "type": "string"
    }
    // Note: password is NOT included in the response
  }
}

2) POST /api/captains/login
- Description: Authenticate a captain with email and password and receive a JWT token.
- Request Headers: `Content-Type: application/json`
- Request Body (JSON):

{
  "email": "string (valid email)", // required
  "password": "string (min 6 chars)" // required
}

- Success Response (200 OK):

{
  "token": "<JWT token string>",
  "captain": {
    "_id": "<id>",
    "fullname": "string",
    "email": "string",
    "vehicle": { /* same shape as above */ }
  }
}

3) GET /api/captains/profile
- Description: Retrieve authenticated captain profile. Protected route.
- Authentication: Cookie `token` (HTTP-only) or `Authorization: Bearer <token>` header.
- Success Response (200 OK):

{
  "message": "Captain fetched successfully",
  "captain": {
    "_id": "<id>",
    "fullname": "string",
    "email": "string",
    "vehicle": { /* color, plate, capacity, type */ }
  }
}

4) GET /api/captains/logout
- Description: Logout the authenticated captain; clears the cookie and blacklists the token.
- Authentication: Cookie `token` or `Authorization` header required.
- Success Response (200 OK):

{
  "message": "Logged out successfully"
}

Notes
- On logout the token (from cookie or header) is saved to the blacklist collection (`Backend/models/blacklistToken.model.js`) to prevent reuse.
- Controller behavior and helpers: see `Backend/controllers/captain.controller.js` and `Backend/services/captain.service.js` for implementation details.


